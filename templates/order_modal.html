<!-- è¨‚å–®è©³æƒ…æ¨¡æ…‹æ¡† -->
<div id="orderModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 id="orderModalTitle">è¨‚å–®è©³æƒ…</h3>
            <button onclick="closeOrderModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>

        <div id="orderDetails">
            <!-- è¨‚å–®è©³æƒ…å…§å®¹å°‡åœ¨é€™è£¡å‹•æ…‹è¼‰å…¥ -->
        </div>

        <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
            <button onclick="closeOrderModal()" style="padding: 0.75rem 1.5rem; border: 2px solid #ddd; background: white; border-radius: 5px; cursor: pointer;">é—œé–‰</button>
        </div>
    </div>
</div>

<script>
// æŸ¥çœ‹è¨‚å–®è©³æƒ…
async function viewOrderDetails(orderId) {
    try {
        const response = await fetch(`${API_BASE}/orders/${orderId}`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            }
        });
        
        if (response.ok) {
            const order = await response.json();
            displayOrderDetails(order);
            document.getElementById('orderModal').style.display = 'block';
        } else {
            alert('è¼‰å…¥è¨‚å–®è©³æƒ…å¤±æ•—');
        }
    } catch (error) {
        alert('è¼‰å…¥è¨‚å–®è©³æƒ…å¤±æ•—: ' + error.message);
    }
}

// é¡¯ç¤ºè¨‚å–®è©³æƒ…
function displayOrderDetails(order) {
    const container = document.getElementById('orderDetails');
    
    container.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- è¨‚å–®è³‡è¨Š -->
            <div>
                <h4 style="margin-bottom: 1rem; color: #333;">è¨‚å–®è³‡è¨Š</h4>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 5px;">
                    <p><strong>è¨‚å–®ç·¨è™Ÿ:</strong> #${order.id}</p>
                    <p><strong>è¨‚å–®æ—¥æœŸ:</strong> ${new Date(order.order_date).toLocaleString()}</p>
                    <p><strong>è¨‚å–®ç‹€æ…‹:</strong> 
                        <span style="padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; 
                                     background: ${getStatusColor(order.status)}; color: white;">
                            ${getStatusText(order.status)}
                        </span>
                    </p>
                    <p><strong>ç¸½é‡‘é¡:</strong> $${order.total_amount}</p>
                    ${order.delivery_method ? `<p><strong>å–è²¨æ–¹å¼:</strong> ${order.delivery_method === '711_store' ? '7-11åº—åˆ°åº—' : order.delivery_method}</p>` : ''}
                    ${order.payment_method ? `<p><strong>ä»˜æ¬¾æ–¹å¼:</strong> ${order.payment_method === 'cash_on_delivery' ? 'è²¨åˆ°ä»˜æ¬¾' : order.payment_method}</p>` : ''}
                </div>
            </div>

            <!-- å®¢æˆ¶è³‡è¨Š -->
            <div>
                <h4 style="margin-bottom: 1rem; color: #333;">å®¢æˆ¶è³‡è¨Š</h4>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 5px;">
                    <p><strong>å§“å:</strong> ${order.customer.first_name} ${order.customer.last_name}</p>
                    <p><strong>ä¿¡ç®±:</strong> ${order.customer.email}</p>
                    <p><strong>é›»è©±:</strong> ${order.customer.phone || 'æœªæä¾›'}</p>
                    <p><strong>åœ°å€:</strong> ${order.customer.address || 'æœªæä¾›'}</p>
                </div>
            </div>
        </div>
        
        ${order.delivery_method === '711_store' && order.store_name ? `
        <div style="margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem; color: #333;">ğŸª 7-11é–€å¸‚è³‡è¨Š</h4>
            <div style="background: #e3f2fd; padding: 1rem; border-radius: 5px; border-left: 4px solid #2196f3;">
                <p><strong>é–€å¸‚åç¨±:</strong> ${order.store_name}</p>
                ${order.store_id ? `<p><strong>é–€å¸‚ä»£ç¢¼:</strong> ${order.store_id}</p>` : ''}
                ${order.store_address ? `<p><strong>é–€å¸‚åœ°å€:</strong> ${order.store_address}</p>` : ''}
            </div>
        </div>
        ` : ''}
        </div>

        <!-- å•†å“æ¸…å–® -->
        <div>
            <h4 style="margin-bottom: 1rem; color: #333;">å•†å“æ¸…å–®</h4>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 5px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #dee2e6;">
                            <th style="text-align: left; padding: 0.75rem; font-weight: 500;">å•†å“åç¨±</th>
                            <th style="text-align: center; padding: 0.75rem; font-weight: 500;">æ•¸é‡</th>
                            <th style="text-align: right; padding: 0.75rem; font-weight: 500;">å–®åƒ¹</th>
                            <th style="text-align: right; padding: 0.75rem; font-weight: 500;">å°è¨ˆ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${order.items.map(item => `
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 0.75rem;">${item.item_name}</td>
                                <td style="text-align: center; padding: 0.75rem;">${item.quantity}</td>
                                <td style="text-align: right; padding: 0.75rem;">$${item.price}</td>
                                <td style="text-align: right; padding: 0.75rem; font-weight: 500;">$${(item.quantity * item.price).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot>
                        <tr style="border-top: 2px solid #dee2e6; background: #e9ecef;">
                            <td colspan="3" style="text-align: right; padding: 0.75rem; font-weight: 500;">ç¸½è¨ˆ:</td>
                            <td style="text-align: right; padding: 0.75rem; font-weight: 500; font-size: 1.1rem;">$${order.total_amount}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    `;
}

// å–å¾—ç‹€æ…‹é¡è‰²
function getStatusColor(status) {
    switch(status) {
        case 'pending': return '#ffc107';
        case 'completed': return '#28a745';
        case 'cancelled': return '#dc3545';
        default: return '#6c757d';
    }
}

// å–å¾—ç‹€æ…‹æ–‡å­—
function getStatusText(status) {
    switch(status) {
        case 'pending': return 'å¾…è™•ç†';
        case 'completed': return 'å·²å®Œæˆ';
        case 'cancelled': return 'å·²å–æ¶ˆ';
        default: return 'æœªçŸ¥';
    }
}

// é—œé–‰è¨‚å–®æ¨¡æ…‹æ¡†
function closeOrderModal() {
    document.getElementById('orderModal').style.display = 'none';
}
</script>
